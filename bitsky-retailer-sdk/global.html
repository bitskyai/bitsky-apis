<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Global</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Global</h1>

    




<section>

<header>
    
        <h2></h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>


        
    
    </div>

    

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                
<h4 class="name" id="Configurations">Configurations</h4>




<div class="description">
    <p>Configurations Schema</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>BITSKY_BASE_URL</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    http://localhost:9099
                
                </td>
            

            <td class="description last"><p>The BitSky Application URL</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>GLOBAL_ID</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>The <strong>global id</strong> of your Retailer Service. Please <a href="https://docs.bitsky.ai/how-tos/how-to-set-an-analyst-service-global_id">Get a Retailer Service Global ID</a></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>PORT</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            
                <td class="default">
                
                    8081
                
                </td>
            

            <td class="description last"><p><a href="http://expressjs.com/en/5x/api.html#app.listen">Express server</a> port number</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>SERVICE_NAME</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    @bitskyai/retailer-sdk
                
                </td>
            

            <td class="description last"><p>Service name, this name will be used for log</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>RETAILER_HOME</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Home folder of this retailer. Default is <code>${process.cwd()}/public</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>LOG_LEVEL</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    info
                
                </td>
            

            <td class="description last"><p>Loging level you want to log. Please find available loging levels from <a href="https://github.com/winstonjs/winston#logging-levels">Winston Logging Levels</a></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ERROR_LOG_FILE_NAME</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    error.log
                
                </td>
            

            <td class="description last"><p>Error log file name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>COMBINED_LOG_FILE_NAME</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    combined.log
                
                </td>
            

            <td class="description last"><p>Combined log file name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>DATA_FILE_NAME</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    data.json
                
                </td>
            

            <td class="description last"><p>Collect data file name. Default is <code>data.json</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>CONNECTOR_TYPE</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    json
                
                </td>
            

            <td class="description last"><p>Connector is used to define the way how to store your data, default is <code>json</code>. Currently, we have two connector type - ['json', 'mongodb']</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>MONGODB_URL</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                    mongodb://localhost:27017/retailer
                
                </td>
            

            <td class="description last"><p>MongoDB url. **Important: ** if you configured <code>MONGODB_URL</code>, then <code>MONGODB_HOST</code> and <code>MONGODB_NAME</code> doesn't work.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>MONGODB_HOST</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>MongoDB host url, like <code>ds123456.mlab.com</code>, <code>10.0.0.247</code>. Default is undefined.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>MONGODB_PORT</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>MongoDB port number, like <code>63410</code>, <code>27017</code>. Default is undefined.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>MONGODB_NAME</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>MongoDB name, like <code>retailer</code>. Default is undefined.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>MONGODB_USERNAME</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>MongoDB user name, like <code>admin</code>. Default is undefined.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>MONGODB_PASSWORD</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>MongoDB password, like <code>123456</code>. Default is undefined.</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="server.js.html">server.js</a>, <a href="server.js.html#line754">line 754</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                
<h4 class="name" id="IndexOptions">IndexOptions</h4>






    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>title</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    Retailer Service
                
                </td>
            

            <td class="description last"><p>Title of this retailer service</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>description</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    A retailer server to crawl data from website
                
                </td>
            

            <td class="description last"><p>Description of this retailer service</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>githubURL</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    https://github.com/bitskyai
                
                </td>
            

            <td class="description last"><p>Your github repo URL</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>homeURL</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    https://bitsky.ai
                
                </td>
            

            <td class="description last"><p>Your github repo URL</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>docURL</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    https://docs.bitsky.ai
                
                </td>
            

            <td class="description last"><p>Your document URL</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>copyright</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    &amp;copy; 2020 BitSky.ai
                
                </td>
            

            <td class="description last"><p>copyright</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>items</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;<a href="global.html#Item">Item</a>></span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Additional links you want to render</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="server.js.html">server.js</a>, <a href="server.js.html#line839">line 839</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                
<h4 class="name" id="Item">Item</h4>






    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>title</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>Item title</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>Item url</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>description</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>Item description</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="server.js.html">server.js</a>, <a href="server.js.html#line850">line 850</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                
<h4 class="name" id="ParseFunReturn">ParseFunReturn</h4>






    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>tasks</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>Send an array of <a href="global.html#Task">Task</a> to <strong>BitSky</strong> application</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>data</code></td>
            

            <td class="type">
            
                
<span class="param-type">integer</span>
|

<span class="param-type">string</span>
|

<span class="param-type">Object</span>
|

<span class="param-type">Array</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>Data you want to save. If <code>data</code> is empty or <code>undefined</code> or <code>null</code>, then nothing will be saved.
If <code>data</code> is an <code>Object</code> not an Array, then data will be saved by property keys, this is useful for in the <code>parse</code> function needs to extract multiple data. <code>data</code> will be saved to Configurations.DATA_PATH</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>response</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last">
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>status</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    200
                
                </td>
            

            <td class="description last"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">HTTP response status code</a>. Any value big than 300 will be considered of fail</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>data</code></td>
            

            <td class="type">
            
                
<span class="param-type">integer</span>
|

<span class="param-type">string</span>
|

<span class="param-type">object</span>
|

<span class="param-type">array</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Data want to send back. Only use when you want to return an error, and you can add the reason of error, it is useful for troubleshoot</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="server.js.html">server.js</a>, <a href="server.js.html#line824">line 824</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                
<h4 class="name" id="Task">Task</h4>






    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>url</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>web page url that need to be processed</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>retailer</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last">
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>globalId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The <strong>global id</strong> of your Retailer Service</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>priority</code></td>
            

            <td class="type">
            
                
<span class="param-type">integer</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    100
                
                </td>
            

            <td class="description last"><p>Priority of this task. Only compare priority for same Retailer Service, doesn't compare cross Retailer Service. Bigger value low priority. Priority value 1 is higher than priority value 2.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>suitableProducers</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                    ["HEADLESSBROWSER"]
                
                </td>
            

            <td class="description last"><p>What kind of producers can execute this task</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>metadata</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>Additional metadata for this task</p>
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>script</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>Code want to execute after <a href="https://pptr.dev/#?product=Puppeteer&amp;version=v4.0.0&amp;show=api-pagegotourl-options">page load</a>. Only <strong>HEADLESSBROSWER</strong> producer can execute code.</p>
<p>You code should be a <code>async function</code>, like this:</p>
<pre class="prettyprint source lang-JavaScript"><code>async function(){
 await $$page.waitFor(5000);
}
</code></pre>
<p>This code will let page wait 5s.</p>
<p>Inside your code, you have four global variables, and you <strong>CANNOT</strong> change it, if you do <code>$$page=newPage</code>, will cause your code execute fail</p>
<ol>
<li><a href="https://pptr.dev/#?product=Puppeteer&amp;version=v4.0.0&amp;show=api-class-page">$$page</a>: Puppeteer page instance, refer to current page</li>
<li><a href="global.html#Task">$task</a>: Task information</li>
<li><a href="https://lodash.com/docs/4.17.15">$$_</a>: Lodash instance</li>
<li><a href="BaseRetailerService.html#logger">$logger</a>: <a href="https://github.com/winstonjs/winston#creating-your-own-logger">Winston Logger</a>, you can add log</li>
</ol>
<p>Except those four global variables, you also can use <code>require</code> to require <a href="https://nodejs.org/en/docs/">NodeJS</a> native modules.</p>
<p>If your return value isn't <code>undefined</code> or <code>null</code>, then this vlaue will be set as <code>dataset</code> and send back to your Retailer Service. If you return <code>undefined</code> or <code>null</code> or don't return any value, then will send whole page back to your Retailer Service.</p>
<p><strong>Example</strong></p>
<p>This example, we will wait 5s, then send whole page back. It is useful for single page application to wait until data finish load.</p>
<pre class="prettyprint source lang-JavaScript"><code>{
 metadata:{
   script: `
             async function(){
               await $$page.waitFor(5000);
             }
           `
 }
}
</code></pre>
<p>You also can define your code as function, and use <code>toString()</code>.</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="server.js.html">server.js</a>, <a href="server.js.html#line775">line 775</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                
<h4 class="name" id="TriggerFunReturn">TriggerFunReturn</h4>






    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>tasks</code></td>
            

            <td class="type">
            
                
<span class="param-type">array</span>


            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>Send an array of <a href="global.html#Task">Task</a> to <strong>BitSky</strong> application</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="server.js.html">server.js</a>, <a href="server.js.html#line834">line 834</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseRetailerService.html">BaseRetailerService</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.5</a> on Thu Oct 22 2020 22:00:46 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>